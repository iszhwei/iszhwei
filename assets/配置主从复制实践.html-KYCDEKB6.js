import{_ as r}from"./plugin-vue_export-helper-x3n3nnut.js";import{r as t,o as c,c as i,d as s,e as a,f as n,w as e,a as o}from"./app-2pke9_a8.js";const B="/assets/image-20240421175118144-CYuzMaJI.png",d="/assets/image-20240421175259989-jlnnQvTG.png",y="/assets/image-20240421175543443-vPc5i-Jr.png",F="/assets/image-20240421225335827-ufn7cYSc.png",_="/assets/image-20240502224833340-K0lCF3Bo.png",u="/assets/2e50fc95c3d6412ca1d0dcd43b0f5049-jFEUJ5-z.png",A="/assets/watermark_type_d3F5LXplbmhlaQ_shadow_50_text_Q1NETiBAQnVnTWFrZXItc2hlbg___size_20_color_FFFFFF_t_70_g_se_x_16-Y8CQB4jv.png",m="/assets/image-20240421235545112-_aY7PUkl.png",g="/assets/watermark_type_d3F5LXplbmhlaQ_shadow_50_text_Q1NETiBAQnVnTWFrZXItc2hlbg___size_19_color_FFFFFF_t_70_g_se_x_16-uNHdcmfR.png",v="/assets/watermark_type_d3F5LXplbmhlaQ_shadow_50_text_Q1NETiBAQnVnTWFrZXItc2hlbg___size_16_color_FFFFFF_t_70_g_se_x_16-3B_pY9kt.png",b="/assets/159c15638ad048619ea8c74646c07e4c-OcG0r4y0.png",h="/assets/watermark_type_d3F5LXplbmhlaQ_shadow_50_text_Q1NETiBAQnVnTWFrZXItc2hlbg___size_14_color_FFFFFF_t_70_g_se_x_16-w8UYl0HQ.png",C="/assets/watermark_type_d3F5LXplbmhlaQ_shadow_50_text_Q1NETiBAQnVnTWFrZXItc2hlbg___size_19_color_FFFFFF_t_70_g_se_x_16-171369367930313-171369368050316-aX_Iihwn.png",f="/assets/watermark_type_d3F5LXplbmhlaQ_shadow_50_text_Q1NETiBAQnVnTWFrZXItc2hlbg___size_20_color_FFFFFF_t_70_g_se_x_16-171369373764818-rXhbLxiT.png",x="/assets/615555e1b0da4617a5ba80260f911b92-WVNtXNWA.png",E="/assets/watermark_type_d3F5LXplbmhlaQ_shadow_50_text_Q1NETiBAQnVnTWFrZXItc2hlbg___size_15_color_FFFFFF_t_70_g_se_x_16-SVLRR-KY.png",D="/assets/watermark_type_d3F5LXplbmhlaQ_shadow_50_text_Q1NETiBAQnVnTWFrZXItc2hlbg___size_20_color_FFFFFF_t_70_g_se_x_16-171369382111525-171369382201228-2-IsHAkZ.png",S="/assets/watermark_type_d3F5LXplbmhlaQ_shadow_50_text_Q1NETiBAQnVnTWFrZXItc2hlbg___size_20_color_FFFFFF_t_70_g_se_x_16-171369384217730-lRWYLdIJ.png",k="/assets/watermark_type_d3F5LXplbmhlaQ_shadow_50_text_Q1NETiBAQnVnTWFrZXItc2hlbg___size_20_color_FFFFFF_t_70_g_se_x_16-171369388608433-4a7SBXqc.png",q="/assets/a2d8c2f04d3d49609764cc11f33794d1-I72daPGT.png",T={},I=o('<h1 id="配置主从复制实践" tabindex="-1"><a class="header-anchor" href="#配置主从复制实践" aria-hidden="true">#</a> 配置主从复制实践</h1><h2 id="一、检测通信" tabindex="-1"><a class="header-anchor" href="#一、检测通信" aria-hidden="true">#</a> 一、检测通信</h2><p>查看master（centos7）和slave（win10）的ip地址，并检测是否可以<strong>相互通信</strong></p><blockquote><p>我自己用的是ubuntu 22.04(master，192.168.216.136)和centos7(slave，192.168.216.137)</p></blockquote><figure><img src="'+B+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>到这里我们知道，master的ip为192.168.131.129，slave的ip为192.168.0.6，并且可以相互通信</p><p>如果物理机可以ping通虚拟机，而虚拟机无法ping通物理机，需要在控制面板的网络中心启用网络发现</p><figure><img src="'+d+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>',8),L={href:"https://blog.csdn.net/Phj456/article/details/122305527",target:"_blank",rel:"noopener noreferrer"},Q=o(`<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">sudo</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">apt</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">install</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">firewalld</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>查看防火墙状态</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">systemctl</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">status</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">firewalld.service</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>临时手动启动、停止防火墙</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">systemctl</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">start</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">firewalld.service</span></span>
<span class="line"><span style="color:#61AFEF;">systemctl</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">stop</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">firewalld.service</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>持久打开、关闭防火墙（重启服务生效）</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">systemctl</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">enable</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">firewalld.service</span></span>
<span class="line"><span style="color:#61AFEF;">systemctl</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">disable</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">firewalld.service</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>开启防火墙3306端口</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">sudo</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">firewall-cmd</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">--zone=public</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">--add-port=3306/tcp</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">--permanent</span><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;"># 开放3306端口</span></span>
<span class="line"><span style="color:#61AFEF;">sudo</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">firewall-cmd</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">--reload</span><span style="color:#ABB2BF;">                     </span><span style="color:#7F848E;font-style:italic;"># 重启防护墙</span></span>
<span class="line"><span style="color:#61AFEF;">sudo</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">firewall-cmd</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">--list-port</span><span style="color:#ABB2BF;">             </span><span style="color:#7F848E;font-style:italic;"># 查看当前开放的端口列表</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>用哪个端口就开放哪个端口</strong>，直接关闭防火墙虽然方便，但是实际工作却不能这样</li></ul><figure><img src="`+y+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><figure><img src="'+F+`" alt="image-20240421225335827" tabindex="0" loading="lazy"><figcaption>image-20240421225335827</figcaption></figure><h2 id="二、master配置" tabindex="-1"><a class="header-anchor" href="#二、master配置" aria-hidden="true">#</a> 二、master配置</h2><h3 id="_1-开启二进制日志" tabindex="-1"><a class="header-anchor" href="#_1-开启二进制日志" aria-hidden="true">#</a> 1. 开启二进制日志</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">sudo</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">vi</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/etc/mysql/mysql.conf.d/mysqld.cnf</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,15),w=s("strong",null,"配置log_bin",-1),N=o('<figure><img src="'+_+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><strong>开启二进制日志后需要重启mysql服务</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 重启mysql，如果mysql报错，就改成mysqld</span></span>
<span class="line"><span style="color:#61AFEF;">systemctl</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">restart</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">mysql</span></span>
<span class="line"><span style="color:#61AFEF;">systemctl</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">start</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">mysql</span></span>
<span class="line"><span style="color:#61AFEF;">systemctl</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">stop</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">mysql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 查看mysql状态</span></span>
<span class="line"><span style="color:#61AFEF;">systemctl</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">status</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">mysql</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">root@ubuntu-vm:/usr/bin#</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">systemctl</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">start</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">mysql</span></span>
<span class="line"><span style="color:#61AFEF;">root@ubuntu-vm:/usr/bin#</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">systemctl</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">status</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">mysql</span></span>
<span class="line"><span style="color:#61AFEF;">●</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">mysql.service</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">-</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">MySQL</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">Community</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">Server</span></span>
<span class="line"><span style="color:#ABB2BF;">     </span><span style="color:#61AFEF;">Loaded:</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">loaded</span><span style="color:#ABB2BF;"> (/lib/systemd/system/mysql.service; </span><span style="color:#61AFEF;">enabled</span><span style="color:#ABB2BF;">; </span><span style="color:#61AFEF;">vendor</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">preset:</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">enabled</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">     </span><span style="color:#61AFEF;">Active:</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">active</span><span style="color:#ABB2BF;"> (running) since Wed 2022-11-16 16:50:56 CST; </span><span style="color:#61AFEF;">5s</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">ago</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#61AFEF;">Process:</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">8333</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">ExecStartPre=/usr/share/mysql/mysql-systemd-start</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">pre</span><span style="color:#ABB2BF;"> (code=exited, </span><span style="color:#98C379;">status=</span><span style="color:#D19A66;">0</span><span style="color:#98C379;">/SUCCESS</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">   </span><span style="color:#61AFEF;">Main</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">PID:</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">8341</span><span style="color:#ABB2BF;"> (mysqld)</span></span>
<span class="line"><span style="color:#ABB2BF;">     </span><span style="color:#61AFEF;">Status:</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;Server is operational&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#61AFEF;">Tasks:</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">39</span><span style="color:#ABB2BF;"> (limit: </span><span style="color:#D19A66;">4582</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">     </span><span style="color:#61AFEF;">Memory:</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">367.3</span><span style="color:#98C379;">M</span></span>
<span class="line"><span style="color:#ABB2BF;">     </span><span style="color:#61AFEF;">CGroup:</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/system.slice/mysql.service</span></span>
<span class="line"><span style="color:#ABB2BF;">             </span><span style="color:#61AFEF;">└─8341</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">/usr/sbin/mysqld</span><span style="color:#ABB2BF;">      </span><span style="color:#7F848E;font-style:italic;"># 这是mysqld路径</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">11月</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">16</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">16</span><span style="color:#98C379;">:50:55</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">ubuntu-vm</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">systemd[</span><span style="color:#D19A66;">1</span><span style="color:#98C379;">]:</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">Starting</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">MySQL</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">Community</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">Server...</span></span>
<span class="line"><span style="color:#61AFEF;">11月</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">16</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">16</span><span style="color:#98C379;">:50:56</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">ubuntu-vm</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">systemd[</span><span style="color:#D19A66;">1</span><span style="color:#98C379;">]:</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">Started</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">MySQL</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">Community</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">Server.</span></span>
<span class="line"><span style="color:#61AFEF;">root@ubuntu-vm:/usr/bin#</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">netstat</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">-tanp</span><span style="color:#ABB2BF;"> | </span><span style="color:#61AFEF;">grep</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">3306</span></span>
<span class="line"><span style="color:#61AFEF;">tcp</span><span style="color:#ABB2BF;">        </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">      </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">0.0</span><span style="color:#98C379;">.0.0:3306</span><span style="color:#ABB2BF;">            </span><span style="color:#D19A66;">0.0</span><span style="color:#98C379;">.0.0:</span><span style="color:#E5C07B;">*</span><span style="color:#ABB2BF;">               </span><span style="color:#98C379;">LISTEN</span><span style="color:#ABB2BF;">      </span><span style="color:#D19A66;">9538</span><span style="color:#98C379;">/mysqld</span><span style="color:#ABB2BF;">         </span></span>
<span class="line"><span style="color:#61AFEF;">tcp</span><span style="color:#ABB2BF;">        </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">      </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">127.0</span><span style="color:#98C379;">.0.1:33060</span><span style="color:#ABB2BF;">         </span><span style="color:#D19A66;">0.0</span><span style="color:#98C379;">.0.0:</span><span style="color:#E5C07B;">*</span><span style="color:#ABB2BF;">               </span><span style="color:#98C379;">LISTEN</span><span style="color:#ABB2BF;">      </span><span style="color:#D19A66;">9538</span><span style="color:#98C379;">/mysqld</span><span style="color:#ABB2BF;">         </span></span>
<span class="line"><span style="color:#61AFEF;">root@ubuntu-vm:/usr/bin#</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-创建一个用于主从库通信用的账号" tabindex="-1"><a class="header-anchor" href="#_2-创建一个用于主从库通信用的账号" aria-hidden="true">#</a> 2.创建一个用于主从库通信用的账号</h3><p><u>从库要连接主库，涉及到账号登陆和身份验证，虽然可以继续使用root账号</u>，但是我们选择重新创建一个新的账号</p><p><strong>即在master中创建一个账号，用于slave登录master读取binlog</strong></p><p>虽然我们在Linux上查看的ip地址是192.168.131.129，但我们创建账户登录时不写这个ip，写的是192.168.131.1。因为我<u>这里虚拟机用的是NAT模式</u>（桥接模式是虚拟机直连物理网络，和物理机的网络地位相同），虚拟机（master）和物理机（windows，slave）通信的时候，<u>虚拟机先把数据发送到网关192.168.131.1（默认与VMnet8通信），192.168.131.1再转发到物理机，</u>所以物理机接收到的是192.168.131.1的数据，故我们在master上为slave创建账户的时候，应该写192.168.131.1</p><figure><img src="`+u+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>如果给slave配置的不是网关192.168.131.1地址，<strong>错误日志（可在my.cnf中指定</strong>）中会有如下信息：</p><figure><img src="'+A+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><u>意思是从192.168.131.1的mslave用户权限不够，那是因为我们在master上配置的是允许从其他地址登录，并不是允许从192.168.131.1地址登录，这就导致权限不够。</u></p><p>由于master这边收到的就是来自192.168.131.1的请求，所以错误日志显示的是192.168.131.1</p><p>所以创建账户的命令应如下：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">mysql</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">CREATE</span><span style="color:#ABB2BF;"> USER </span><span style="color:#98C379;">&#39;mslave&#39;</span><span style="color:#ABB2BF;">@</span><span style="color:#98C379;">&#39;%&#39;</span><span style="color:#ABB2BF;"> IDENTIFIED </span><span style="color:#C678DD;">BY</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;14ds@EGBFV&#39;</span><span style="color:#ABB2BF;">; # “%”表示任意ip都可以通过这个账号登录</span></span>
<span class="line"><span style="color:#ABB2BF;">mysql</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">CREATE</span><span style="color:#ABB2BF;"> USER </span><span style="color:#98C379;">&#39;mslave&#39;</span><span style="color:#ABB2BF;">@</span><span style="color:#98C379;">&#39;192.168.131.1&#39;</span><span style="color:#ABB2BF;"> IDENTIFIED </span><span style="color:#C678DD;">BY</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;14ds@EGBFV&#39;</span><span style="color:#ABB2BF;">; #为了权限最小化，权限收缩，我们指定ip才能登录</span></span>
<span class="line"><span style="color:#ABB2BF;">mysql</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">create</span><span style="color:#ABB2BF;"> user </span><span style="color:#98C379;">&#39;mslave&#39;</span><span style="color:#ABB2BF;">@</span><span style="color:#98C379;">&#39;192.168.131.1&#39;</span><span style="color:#ABB2BF;"> identified </span><span style="color:#C678DD;">WITH</span><span style="color:#ABB2BF;"> mysql_native_password </span><span style="color:#C678DD;">by</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;123456&#39;</span><span style="color:#ABB2BF;">;#弱密码</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">mysql</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">GRANT</span><span style="color:#ABB2BF;"> REPLICATION SLAVE </span><span style="color:#C678DD;">ON</span><span style="color:#ABB2BF;"> *.* </span><span style="color:#C678DD;">to</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;mslave&#39;</span><span style="color:#ABB2BF;">@</span><span style="color:#98C379;">&#39;192.168.131.1&#39;</span><span style="color:#ABB2BF;"> IDENTIFIED </span><span style="color:#C678DD;">BY</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;14ds@EGBFV&#39;</span><span style="color:#ABB2BF;">;  </span><span style="color:#7F848E;font-style:italic;">-- 给mslave用户主从同步的权限（REPLICATION SLAVE）mysql5.7</span></span>
<span class="line"><span style="color:#ABB2BF;">mysql</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">GRANT</span><span style="color:#ABB2BF;"> REPLICATION SLAVE </span><span style="color:#C678DD;">ON</span><span style="color:#ABB2BF;"> *.* </span><span style="color:#C678DD;">to</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;mslave&#39;</span><span style="color:#ABB2BF;">@</span><span style="color:#98C379;">&#39;192.168.131.1&#39;</span><span style="color:#ABB2BF;">;#mysql8</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">mysql</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> FLUSH PRIVILEGES;                   </span><span style="color:#7F848E;font-style:italic;">-- 刷新权限，使权限生效</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>开启主从复制的权限，从库可以通过这个账户和密码，从这个IP来请求访问这个主库上的任意库，同步这个主库的任意库里的任意表</p><ul><li><code>*.*</code>表示任意库任意表，当然也可以指定库指定表，如<code>school.user</code></li></ul>`,17),R=s("figure",null,[s("img",{src:m,alt:"",tabindex:"0",loading:"lazy"}),s("figcaption")],-1),z=s("h3",{id:"_3-获取binlog文件名和position",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_3-获取binlog文件名和position","aria-hidden":"true"},"#"),a(" 3.获取binlog文件名和position")],-1),M=s("strong",null,"开始",-1),O=o(`<div class="language-sql line-numbers-mode" data-ext="sql"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">show </span><span style="color:#C678DD;">master</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">status</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="`+g+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="三、slave配置" tabindex="-1"><a class="header-anchor" href="#三、slave配置" aria-hidden="true">#</a> 三、slave配置</h2><h3 id="_1-配置全局唯一的server-id" tabindex="-1"><a class="header-anchor" href="#_1-配置全局唯一的server-id" aria-hidden="true">#</a> 1. 配置全局唯一的server-id</h3><p>找到my.ini</p><figure><img src="'+v+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>配置全局唯一的server-id</p><figure><img src="'+b+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>重启MySQL服务</p><figure><img src="'+h+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_2-使用master创建的账户读取binlog同步数据" tabindex="-1"><a class="header-anchor" href="#_2-使用master创建的账户读取binlog同步数据" aria-hidden="true">#</a> 2. 使用master创建的账户读取binlog同步数据</h3><p>这一步配置主要是给IO线程读取binlog使用</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">mysql</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> CHANGE </span><span style="color:#C678DD;">MASTER</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">TO</span><span style="color:#ABB2BF;"> MASTER_HOST</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;192.168.131.129&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">MASTER_PORT</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">3306</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">MASTER_USER</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;mslave&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">MASTER_PASSWORD</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;1qaz@WSX&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">MASTER_LOG_FILE</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;mysql-bin.000007&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">MASTER_LOG_POS</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">1262</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>MASTER_HOST：指定master的ip MASTER_LOG_FILE：binlog文件名 MASTER_LOG_POS：binlog的position</p><h3 id="_3-启动slave服务" tabindex="-1"><a class="header-anchor" href="#_3-启动slave服务" aria-hidden="true">#</a> 3. 启动slave服务</h3><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">mysql</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">start</span><span style="color:#ABB2BF;"> slave;</span></span>
<span class="line"><span style="color:#ABB2BF;">mysql</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">stop</span><span style="color:#ABB2BF;"> slave;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>通过show slave status命令查看主从复制状态，show processlist查看master和salve相关线程的运行状态</p><figure><img src="`+C+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>自己配置的时候不知道为什么，slave总是连接不上master，重新在mysql.user表中设置一下密码，就能连接上了</p><h2 id="四、配置中可能出现的问题" tabindex="-1"><a class="header-anchor" href="#四、配置中可能出现的问题" aria-hidden="true">#</a> 四、配置中可能出现的问题</h2><h3 id="_1-网络连接问题" tabindex="-1"><a class="header-anchor" href="#_1-网络连接问题" aria-hidden="true">#</a> 1. 网络连接问题</h3>',21),X={href:"https://blog.csdn.net/Ryxiong728/article/details/105016128",target:"_blank",rel:"noopener noreferrer"},V={href:"https://blog.csdn.net/weixin_42054155/article/details/113924377",target:"_blank",rel:"noopener noreferrer"},G={href:"https://zhuanlan.zhihu.com/p/83765702",target:"_blank",rel:"noopener noreferrer"},P=s("p",null,"MySQL 复制仅在连续主版本之间支持，并且仅从主低到从高之间支持。",-1),W=s("p",null,[s("strong",null,"master 5.7 - > slave 8.0"),a(" 支持")],-1),Y=s("strong",null,"master 8.0 - > slave 5.7",-1),H=o('<p>通过show slave status命令查看主从复制状态</p><figure><img src="'+f+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>连接connection错误，先考虑是否网络互通，ping一下</p><p>然后再检查从库里面的配置信息是否正确</p><figure><img src="'+x+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>如果都正确，还可以检查一下master的3306端口是否可以连接</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">telnet</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">xxx.xxx.xxx.xxx</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">3306</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>最重要的是，自己玩的时候，如果虚拟机是NAT模式，则需要写成VMnet8网关ip。如果都是物理机通信，那直接写正确的ip即可</p><p>可以在MySQL数据库下的mysql库的user表中更改允许登录的ip</p><figure><img src="`+E+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>然后重新赋予权限</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">mysql</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">GRANT</span><span style="color:#ABB2BF;"> REPLICATION SLAVE </span><span style="color:#C678DD;">ON</span><span style="color:#ABB2BF;"> *.* </span><span style="color:#C678DD;">to</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;mslave&#39;</span><span style="color:#ABB2BF;">@</span><span style="color:#98C379;">&#39;xxx.xxx.xxx.xxx&#39;</span><span style="color:#ABB2BF;"> IDENTIFIED </span><span style="color:#C678DD;">BY</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;1qaz@WSX&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>出现错误后还可以查看错误日志中提示的ip是否和自己允许slave登录的ip一致</p><figure><img src="`+D+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_2-binlog的position问题" tabindex="-1"><a class="header-anchor" href="#_2-binlog的position问题" aria-hidden="true">#</a> 2. binlog的position问题</h3><figure><img src="'+S+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>在master中查看<code>show master status</code>一下binlog日志文件名以及position，然后用命令重新配置slave，比如：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">mysql</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> CHANGE </span><span style="color:#C678DD;">MASTER</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">TO</span><span style="color:#ABB2BF;"> MASTER_HOST</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;192.168.131.129&#39;</span><span style="color:#ABB2BF;">,MASTER_PORT</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">3306</span><span style="color:#ABB2BF;">,MASTER_USER</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;mslave&#39;</span><span style="color:#ABB2BF;">,MASTER_PASSWORD</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;1qaz@WSX&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">MASTER_LOG_FILE</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;mysql-bin.000006&#39;</span><span style="color:#ABB2BF;">,MASTER_LOG_POS</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">1262</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>配置slave前需要stop slave</strong>，配置完成再start slave</p><h3 id="_3-sql线程出错" tabindex="-1"><a class="header-anchor" href="#_3-sql线程出错" aria-hidden="true">#</a> 3.SQL线程出错</h3><p>问题发生原因如下：</p><p>首先配置主从复制的时候，slave的mytest库中没有user表，而master的mytest库已经有user表了</p>`,22),Z=s("figure",null,[s("img",{src:k,alt:"",tabindex:"0",loading:"lazy"}),s("figcaption")],-1),U=s("p",null,[s("u",null,[a("一般我们不会做这样的操作，一般都是"),s("strong",null,"主从配置以后，slave从数据开始增量进行同步，先做数据的增量，然后做数据的增删改查")])],-1),j=s("p",null,"不会配置好主从复制后，一开始就删主库的东西，如果真的出现这样的问题，随时可以在从库 show slave status，来查看主从同步的状态，有什么错误，就相应解决",-1),J=o(`<div class="language-sql line-numbers-mode" data-ext="sql"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">mysql</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">stop</span><span style="color:#ABB2BF;"> slave;</span></span>
<span class="line"><span style="color:#ABB2BF;">mysql</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">set</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">global</span><span style="color:#ABB2BF;"> sql_slave_skip_counter</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">mysql</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">start</span><span style="color:#ABB2BF;"> slave;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),K=s("code",null,"show slave status",-1),$=o('<figure><img src="'+q+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><p>在网络互通的前提下，进行配置</p><h3 id="master配置" tabindex="-1"><a class="header-anchor" href="#master配置" aria-hidden="true">#</a> master配置</h3><ol><li>配置文件配置server-id，开启binlog</li><li>创建slave账户并配置复制权限，用于登录主库取数据</li><li><code>show master status;</code> 查看当前binlog文件以及位置</li></ol><h3 id="slave配置" tabindex="-1"><a class="header-anchor" href="#slave配置" aria-hidden="true">#</a> slave配置</h3><ol><li>配置server-id</li><li>使用CHANGE MASTER TO 命令，将master的<u>ip、port、账号、密码、binlog文件名、binlog位置</u>告诉slave</li><li>start slave</li></ol><p><strong>出错后可以查看错误日志</strong></p>',8);function ss(as,ns){const p=t("ExternalLinkIcon"),l=t("font");return c(),i("div",null,[I,s("p",null,[s("a",L,[a("虚拟机无法ping通物理机解决方案"),n(p)])]),Q,s("p",null,[w,a("和"),s("u",null,[n(l,{color:"red"},{default:e(()=>[a("全局唯一的server-id")]),_:1}),a("，和slave区分开")]),a("，不能配置成一样的（"),n(l,{color:"red"},{default:e(()=>[a("如果是my.cnf新添加配置，一定要重启MySQL服务")]),_:1}),a("）")]),N,s("p",null,[a("（"),n(l,{color:"red"},{default:e(()=>[a("在给mslave赋予从库权限时，一直报语法错误，可能是MySQL版本更新了，不需要写IDENTIFIED BY ")]),_:1}),a("）")]),R,z,s("p",null,[a("查看当前二进制日志的名字，主库的更新是往哪个binlog写的，以及当前写日志的位置，"),n(l,{color:"red"},{default:e(()=>[a("从这个位置往后"),M,a("进行主从同步")]),_:1}),a("font>")]),O,s("p",null,[a("["),s("a",X,[a("mysql] 主从同步错误Last_IO_Errno: 2061_last_io_errno:2061-CSDN博客"),n(p)])]),s("p",null,[s("a",V,[a("Mysql主从同步配置字符集问题解决_mysqlbinlog: character set '#255' is not a compile-CSDN博客"),n(p)])]),s("p",null,[s("a",G,[a("技术分享 | 从 MySQL 8.0 复制到 MySQL 5.7 - 知乎 (zhihu.com)"),n(p)])]),s("blockquote",null,[P,W,s("p",null,[Y,a(),n(l,{color:"red"},{default:e(()=>[a("不支持")]),_:1})])]),H,s("p",null,[a("配置好主从复制后直接drop table mytest.user，这就会写到binlog里面，然后在通过dump线程和IO线程将这个操作发送到从库的relay log，然后从库的SQL线程从relay log里把drop table mytest.user捞出来在从库执行这个SQL，可从库的mytest根本就没有user表，这就是=="),n(l,{color:"red"},{default:e(()=>[a("删除一个不存在的表，于是出现错误了")]),_:1}),a("==")]),Z,U,j,s("ol",null,[s("li",null,[n(l,{color:"green"},{default:e(()=>[a("要么stop slave，把position重新设置一下，start slave，即**重新开启主从同步，从最新的位置**，这个drop操作不需要在从库上同步")]),_:1})]),s("li",null,[n(l,{color:"green"},{default:e(()=>[a("要么就是stop，**跳过该个错误**，然后start")]),_:1})])]),J,s("p",null,[a("可以通过"),K,a("查看以下标识，"),s("strong",null,[a("IO线程出错一般是"),n(l,{color:"red"},{default:e(()=>[a("网络问题")]),_:1}),a("，SQL线程出错一般是"),n(l,{color:"red"},{default:e(()=>[a("SQL在slave库执行出现了问题")]),_:1})])]),$])}const os=r(T,[["render",ss],["__file","配置主从复制实践.html.vue"]]);export{os as default};

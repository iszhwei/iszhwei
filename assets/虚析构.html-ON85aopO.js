import{_ as o}from"./plugin-vue_export-helper-x3n3nnut.js";import{r as c,o as B,c as t,d as n,e as s,f as l,w as p,a as e}from"./app-mYdPlPhZ.js";const r="data:image/png;base64,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",i="/assets/20200314114928739-q5dgyzPA.png",y="/assets/20200314120234264-lmJyDxWs.png",d={},v=n("h1",{id:"虚析构",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#虚析构","aria-hidden":"true"},"#"),s(" 虚析构")],-1),A=n("p",null,[s("虽然构造函数不能被定义成虚函数，但"),n("strong",null,"析构函数可以定义为虚函数"),s("，一般来说，如果类中定义了虚函数，析构函数也应被定义为虚析构函数，尤其是类内有申请的动态内存，需要清理和释放的时候。")],-1),F=n("h2",{id:"什么时候需要把基类的析构函数必须实现成虚函数",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#什么时候需要把基类的析构函数必须实现成虚函数","aria-hidden":"true"},"#"),s(),n("strong",null,"什么时候需要把基类的析构函数必须实现成虚函数？")],-1),u={id:"示例一-基类的指针-引用-指向堆上new出来的派生类对象的时候",tabindex:"-1"},D=n("a",{class:"header-anchor",href:"#示例一-基类的指针-引用-指向堆上new出来的派生类对象的时候","aria-hidden":"true"},"#",-1),m=n("u",null,"否则会导致派生类的析构函数无法调用",-1),b=e(`<div class="language-c++ line-numbers-mode" data-ext="c++"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">class</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Base</span></span>
<span class="line"><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#C678DD;">public:</span></span>
<span class="line"><span style="color:#ABB2BF;">	</span><span style="color:#61AFEF;">Base</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">data</span><span style="color:#ABB2BF;">) :</span><span style="color:#61AFEF;">ma</span><span style="color:#ABB2BF;">(data)</span></span>
<span class="line"><span style="color:#ABB2BF;">	{</span></span>
<span class="line"><span style="color:#ABB2BF;">		cout </span><span style="color:#C678DD;">&lt;&lt;</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;Base()&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">&lt;&lt;</span><span style="color:#ABB2BF;"> endl;</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#ABB2BF;">	</span><span style="color:#61AFEF;">~Base</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">	{</span></span>
<span class="line"><span style="color:#ABB2BF;">		cout </span><span style="color:#C678DD;">&lt;&lt;</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;~Base()&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">&lt;&lt;</span><span style="color:#ABB2BF;"> endl;</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#ABB2BF;">	</span><span style="color:#C678DD;">virtual</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">void</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">show</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">	{</span></span>
<span class="line"><span style="color:#ABB2BF;">		cout </span><span style="color:#C678DD;">&lt;&lt;</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;call Base::show()&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">&lt;&lt;</span><span style="color:#ABB2BF;"> endl;</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#C678DD;">protected:</span></span>
<span class="line"><span style="color:#ABB2BF;">	</span><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> ma;</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Derive</span><span style="color:#ABB2BF;"> : </span><span style="color:#C678DD;">public</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Base</span></span>
<span class="line"><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#C678DD;">public:</span></span>
<span class="line"><span style="color:#ABB2BF;">	</span><span style="color:#61AFEF;">Derive</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">data</span><span style="color:#ABB2BF;">):</span><span style="color:#61AFEF;">Base</span><span style="color:#ABB2BF;">(data), </span><span style="color:#61AFEF;">mb</span><span style="color:#ABB2BF;">(data),</span><span style="color:#61AFEF;">ptr</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;">(data))</span></span>
<span class="line"><span style="color:#ABB2BF;">	{</span></span>
<span class="line"><span style="color:#ABB2BF;">		cout </span><span style="color:#C678DD;">&lt;&lt;</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;Derive()&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">&lt;&lt;</span><span style="color:#ABB2BF;"> endl;</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#ABB2BF;">	</span><span style="color:#61AFEF;">~Derive</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">	{</span></span>
<span class="line"><span style="color:#ABB2BF;">		</span><span style="color:#C678DD;">delete</span><span style="color:#ABB2BF;"> ptr;</span></span>
<span class="line"><span style="color:#ABB2BF;">		cout </span><span style="color:#C678DD;">&lt;&lt;</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;~Derive() &quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">&lt;&lt;</span><span style="color:#ABB2BF;"> endl;</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#C678DD;">private:</span></span>
<span class="line"><span style="color:#ABB2BF;">	</span><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> mb;</span></span>
<span class="line"><span style="color:#ABB2BF;">	</span><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">*</span><span style="color:#ABB2BF;">ptr;</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">main</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">	Base </span><span style="color:#56B6C2;">*</span><span style="color:#ABB2BF;">pb </span><span style="color:#C678DD;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">Derive</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">	</span><span style="color:#E5C07B;">pb</span><span style="color:#ABB2BF;">-&gt;</span><span style="color:#61AFEF;">show</span><span style="color:#ABB2BF;">();</span><span style="color:#7F848E;font-style:italic;">//动态绑定pb Base*   *pb Derive</span></span>
<span class="line"><span style="color:#ABB2BF;">	</span><span style="color:#C678DD;">delete</span><span style="color:#ABB2BF;"> pb;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">	</span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+r+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>',2),C=n("figure",null,[n("img",{src:i,alt:"",tabindex:"0",loading:"lazy"}),n("figcaption")],-1),E=e(`<p><strong>解决方案</strong>： <strong>将基类的析构函数定义为虚析构函数，派生类的析构函数自动成为虚函数</strong>。 <u>pb的类型是Base类型，调用析构时去Base中找<code>Base::~Base</code>发现它为虚函数，发生动态绑定。派生类的虚函数表中：<code>&amp;Derive:: ~derive</code>，用派生类析构函数将自己部分进行析构，再调用基类的析构函数将基类部分析构。</u></p><div class="language-c++ line-numbers-mode" data-ext="c++"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">class</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Base</span></span>
<span class="line"><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#C678DD;">public:</span></span>
<span class="line"><span style="color:#ABB2BF;">	</span><span style="color:#61AFEF;">Base</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">data</span><span style="color:#ABB2BF;">) :</span><span style="color:#61AFEF;">ma</span><span style="color:#ABB2BF;">(data)</span></span>
<span class="line"><span style="color:#ABB2BF;">	{</span></span>
<span class="line"><span style="color:#ABB2BF;">		cout </span><span style="color:#C678DD;">&lt;&lt;</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;Base()&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">&lt;&lt;</span><span style="color:#ABB2BF;"> endl;</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#ABB2BF;">	</span><span style="color:#C678DD;">virtual</span><span style="color:#61AFEF;">~Base</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">	{</span></span>
<span class="line"><span style="color:#ABB2BF;">		cout </span><span style="color:#C678DD;">&lt;&lt;</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;~Base()&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">&lt;&lt;</span><span style="color:#ABB2BF;"> endl;</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#ABB2BF;">	</span><span style="color:#C678DD;">virtual</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">void</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">show</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">	{</span></span>
<span class="line"><span style="color:#ABB2BF;">		cout </span><span style="color:#C678DD;">&lt;&lt;</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;call Base::show()&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">&lt;&lt;</span><span style="color:#ABB2BF;"> endl;</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#C678DD;">protected:</span></span>
<span class="line"><span style="color:#ABB2BF;">	</span><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> ma;</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Derive</span><span style="color:#ABB2BF;"> : </span><span style="color:#C678DD;">public</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Base</span></span>
<span class="line"><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#C678DD;">public:</span></span>
<span class="line"><span style="color:#ABB2BF;">	</span><span style="color:#61AFEF;">Derive</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">data</span><span style="color:#ABB2BF;">):</span><span style="color:#61AFEF;">Base</span><span style="color:#ABB2BF;">(data), </span><span style="color:#61AFEF;">mb</span><span style="color:#ABB2BF;">(data),</span><span style="color:#61AFEF;">ptr</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;">(data))</span></span>
<span class="line"><span style="color:#ABB2BF;">	{</span></span>
<span class="line"><span style="color:#ABB2BF;">		cout </span><span style="color:#C678DD;">&lt;&lt;</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;Derive()&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">&lt;&lt;</span><span style="color:#ABB2BF;"> endl;</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#ABB2BF;">	</span><span style="color:#61AFEF;">~Derive</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">	{</span></span>
<span class="line"><span style="color:#ABB2BF;">		</span><span style="color:#C678DD;">delete</span><span style="color:#ABB2BF;"> ptr;</span></span>
<span class="line"><span style="color:#ABB2BF;">		cout </span><span style="color:#C678DD;">&lt;&lt;</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;~Derive() &quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">&lt;&lt;</span><span style="color:#ABB2BF;"> endl;</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#C678DD;">private:</span></span>
<span class="line"><span style="color:#ABB2BF;">	</span><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> mb;</span></span>
<span class="line"><span style="color:#ABB2BF;">	</span><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">*</span><span style="color:#ABB2BF;">ptr;</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+y+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>',3),g={id:"示例二-类内有申请的动态内存-需要清理和释放的时候",tabindex:"-1"},f=n("a",{class:"header-anchor",href:"#示例二-类内有申请的动态内存-需要清理和释放的时候","aria-hidden":"true"},"#",-1),h=e(`<div class="language-c++ line-numbers-mode" data-ext="c++"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">class</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Base</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#C678DD;">public:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#61AFEF;">Base</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">char</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">*</span><span style="color:#E06C75;font-style:italic;">pbase</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    : </span><span style="color:#61AFEF;">_pbase</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">char</span><span style="color:#ABB2BF;">[</span><span style="color:#61AFEF;">strlen</span><span style="color:#ABB2BF;">(pbase) </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]())</span></span>
<span class="line"><span style="color:#ABB2BF;">    {   </span></span>
<span class="line"><span style="color:#ABB2BF;">        cout </span><span style="color:#C678DD;">&lt;&lt;</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;Base(const char *)&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">&lt;&lt;</span><span style="color:#ABB2BF;"> endl;   </span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#61AFEF;">strcpy</span><span style="color:#ABB2BF;">(_pbase, pbase);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    /*virtual*/</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#61AFEF;">~Base</span><span style="color:#ABB2BF;">() </span></span>
<span class="line"><span style="color:#ABB2BF;">    {   </span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;">(_pbase)</span></span>
<span class="line"><span style="color:#ABB2BF;">        {</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;">delete</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">[]</span><span style="color:#ABB2BF;"> _pbase;   </span></span>
<span class="line"><span style="color:#ABB2BF;">            _pbase </span><span style="color:#C678DD;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">nullptr</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span></span>
<span class="line"><span style="color:#ABB2BF;">        cout </span><span style="color:#C678DD;">&lt;&lt;</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;~Base()&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">&lt;&lt;</span><span style="color:#ABB2BF;"> endl;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span></span>
<span class="line"><span style="color:#C678DD;">private:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">char</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">*</span><span style="color:#ABB2BF;">_pbase;</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Derived</span></span>
<span class="line"><span style="color:#ABB2BF;">: </span><span style="color:#C678DD;">public</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Base</span></span>
<span class="line"><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#C678DD;">public:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#61AFEF;">Derived</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">char</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">*</span><span style="color:#E06C75;font-style:italic;">pbase</span><span style="color:#ABB2BF;">, </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">char</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">*</span><span style="color:#E06C75;font-style:italic;">pderived</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    : </span><span style="color:#61AFEF;">Base</span><span style="color:#ABB2BF;">(pbase)</span></span>
<span class="line"><span style="color:#ABB2BF;">    , </span><span style="color:#61AFEF;">_pderived</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">char</span><span style="color:#ABB2BF;">[</span><span style="color:#61AFEF;">strlen</span><span style="color:#ABB2BF;">(pderived) </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]())</span></span>
<span class="line"><span style="color:#ABB2BF;">    {   </span></span>
<span class="line"><span style="color:#ABB2BF;">        cout </span><span style="color:#C678DD;">&lt;&lt;</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;Derived(const char *, const char *)&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">&lt;&lt;</span><span style="color:#ABB2BF;"> endl;  </span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#61AFEF;">strcpy</span><span style="color:#ABB2BF;">(_pderived, pderived);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#61AFEF;">~Derived</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    {</span></span>
<span class="line"><span style="color:#ABB2BF;">        cout </span><span style="color:#C678DD;">&lt;&lt;</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;~Derived()&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">&lt;&lt;</span><span style="color:#ABB2BF;"> endl;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;">(_pderived)</span></span>
<span class="line"><span style="color:#ABB2BF;">        {</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;">delete</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">[]</span><span style="color:#ABB2BF;"> _pderived;    </span></span>
<span class="line"><span style="color:#ABB2BF;">            _pderived </span><span style="color:#C678DD;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">nullptr</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#C678DD;">private:</span></span>
<span class="line"><span style="color:#ABB2BF;">   </span><span style="color:#C678DD;">char</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">*</span><span style="color:#ABB2BF;">_pderived;</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">void</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">test</span><span style="color:#ABB2BF;">() </span></span>
<span class="line"><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">    Base </span><span style="color:#56B6C2;">*</span><span style="color:#ABB2BF;">pbase </span><span style="color:#C678DD;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">Derived</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;hello&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;wuhan&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">pbase</span><span style="color:#ABB2BF;">-&gt;</span><span style="color:#61AFEF;">print</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">delete</span><span style="color:#ABB2BF;"> pbase;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),w=n("code",null,"delete pbase;",-1),Y=n("p",null,[n("strong",null,"如果基类的析构函数声明为虚的，派生类的析构函数也将自动成为虚析构函数，无论派生类析构函数声明中是否加virtual关键字。")],-1);function q(M,P){const a=c("font");return B(),t("div",null,[v,A,F,n("h3",u,[D,s(" 示例一：基类的指针(引用)指向"),l(a,{color:"red"},{default:p(()=>[s("堆上new出来的派生类对象")]),_:1}),s("的时候")]),n("p",null,[s("基类的指针(引用)指向"),l(a,{color:"red"},{default:p(()=>[s("堆上new出来的派生类对象")]),_:1}),s("的时候，delete调用析构函数的时候，必须发生动态绑定，"),m,s("。")]),b,n("p",null,[s("执行出现问题："),l(a,{color:"red"},{default:p(()=>[s("派生类的析构函数没有被调用到，内存泄露")]),_:1}),s("。")]),C,n("p",null,[n("u",null,[s("pb的类型是Base类型，因此delete调用析构函数先去Base中找Base::~Base()，"),n("strong",null,[s("此时对于析构函数的调用就是"),l(a,{color:"red"},{default:p(()=>[s("静态绑定")]),_:1}),s("，没有机会调用派生类的析构函数，最后发生内存泄露")]),s("。")])]),E,n("h3",g,[f,s(" 示例二：类内有申请的"),l(a,{color:"red"},{default:p(()=>[s("动态内存")]),_:1}),s("，需要清理和释放的时候")]),h,n("p",null,[s("如果基类Base的析构函数没有设置为虚函数， 则在执行"),w,s("语句时，不会调用派生类Derived的析构函数，这样就会造成"),l(a,{color:"red"},{default:p(()=>[s("内存泄漏")]),_:1}),s("。此时，将基类Base的析构函数设置为虚函数，就可以解决该问题。")]),l(a,{color:"red"},{default:p(()=>[s("如果有一个基类的指针指向派生类的对象，并且想通过该指针delete派生类对象，系统将只会执行基类的析构函数，而不会执行派生类的析构函数")]),_:1}),s("。"),l(a,{color:"green"},{default:p(()=>[s("为避免这种情况的发生，往往把基类的析构函数声明为虚的")]),_:1}),s("，此时，系统将先执行派生类对象的析构函数，然后再执行基类的析构函数。"),Y])}const U=o(d,[["render",q],["__file","虚析构.html.vue"]]);export{U as default};
